---
title: å…¨åœºæ™¯çš„æ·±æ‹·è´
date: 2022-01-05
tags:
  - JavaScript
---

## å…¨åœºæ™¯çš„æ·±æ‹·è´

```javascript
// type tag
const objTag = '[object Object]';
const arrTag = '[oject Array]';
const dateTag = '[object Date]';
const mapTag = '[object Map]';
const setTag = '[object Set]';
/**
 * clone function
 * å†™è¿™å‡ ç§ç±»åž‹å°±å¤Ÿï¼Œå½“ç„¶å®žé™…åœºæ™¯ä¸‹æ ¹æ®éœ€æ±‚æ‰©å±•
*/
const cloneDeep = target => {
    const type = Object.prototype.toString.call(target);
    switch (type) {
        // å¯¹è±¡ç±»åž‹
        case objTag:
            return Object.keys(target).reduce((result, key) => {
                const value = target[key];
                result[key] = cloneDeep(value);
                return result;
            }, {});
        // æ•°ç»„ç±»åž‹
        case arrTag:
            return target.reduce((result, key) => {
                const value = target[key];
                result[key] = cloneDeep(value);
                return result;
            }, []);
        // æ—¥æœŸç±»åž‹
        case dateTag:
            return new target.constructor(target);
        // seté›†åˆ
        case setTag:
            const cloneSet = new Set();
            return [...target].reduce((result, item) => {
                result.add(item);
                return result;
            }, cloneSet);
        // mapæ˜ å°„è¡¨
        case mapTag:
            const cloneMap = new Map();
            target.forEach((item, key) => {
                cloneMap.set(key, item);
            });
            return cloneMap;
        // å…¶ä»–é»˜è®¤ä¸ºåŸºæœ¬ç±»åž‹è¿”å›žè‡ªå·±å°±è¡Œ
        default:
            return target;
    }
};

// æ¨¡æ‹Ÿä½¿ç”¨åœºæ™¯ðŸ‘Œ
// new map
const g = new Map();
g.set('a', 'aaa');
g.set('b', 'bbb');
// new set
const h = new Set([1, 2, 3]);
// object
const test = {
    a: 'a',
    b: {
        b1: 'b1',
        b2: {
            b21: 'b21',
            b22: 'b22',
            b23: {
                b231: 'b231',
                b232: 'b232'
            }
        },
        b3: 'b3'
    },
    c: 1000,
    d: Error('this is a error'),
    e: [1, 2, 3],
    f: new Date('2022-12-12'),
    g,
    h,
    i: false
};
const obj = cloneDeep(test);
// æµ‹è¯•ä¸€ä¸‹ï¼Œæœ¨æœ‰é—®é¢˜
obj.h.add(999);
obj.i = true;
console.log('obj: ', obj, test);
```